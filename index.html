<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>å…¨å°äººè¡Œé“å°èˆªåœ°åœ– (å®Œæ•´ç‰ˆ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; background: #eee; }
        
        /* è³‡è¨Šé¢æ¿æ¨£å¼ */
        .info-box {
            position: absolute; top: 10px; left: 50px; z-index: 1000;
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: "Microsoft JhengHei", sans-serif;
            max-width: 300px;
        }
        
        /* è®€å–é€²åº¦æ¢æ¨£å¼ */
        .loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; color: white; font-family: sans-serif;
        }
        .spinner {
            border: 6px solid #f3f3f3; border-top: 6px solid #3498db;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* iPad/æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 600px) {
            .info-box { left: 10px; right: 10px; top: 10px; max-width: none; }
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text">æ­£åœ¨å•Ÿå‹•å°èˆªç³»çµ±...</div>
        <div id="loading-detail" style="font-size: 0.8em; color: #ccc; margin-top: 5px;">æº–å‚™è®€å–åœ–è³‡</div>
    </div>

    <div class="info-box">
        <h3 style="margin: 0 0 10px 0;">ğŸš¶ å…¨å°äººè¡Œé“åœ°åœ–</h3>
        <div id="status" style="font-size: 14px; color: #555;">
            è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ– (é è¨­ä¸­å¿ƒé»ï¼šå°ç£ä¸­éƒ¨)
        var map = L.map('map').setView([23.97565, 120.9738819], 8);

        // 2. åŠ å…¥åº•åœ– (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors | è³‡æ–™ä¾†æº: åœ‹åœŸç®¡ç†ç½²',
            maxZoom: 19
        }).addTo(map);

        // ==========================================
        // æ ¸å¿ƒé‚è¼¯ï¼šè‡ªå‹•é€£çºŒè®€å–åˆ†å‰²æª”
        // ==========================================
        
        var filePrefix = 'map_part_';   // æª”åå‰ç¶´
        var fileSuffix = '.geojson';    // æª”åå¾Œç¶´
        var currentPart = 1;            // å¾ç¬¬ 1 ä»½é–‹å§‹
        var totalLoaded = 0;            // è¨ˆç®—è¼‰å…¥å¹¾ç­†è³‡æ–™

        // è¨­å®šäººè¡Œé“æ¨£å¼ (è—è‰²ç·šæ¢)
        var sidewalkStyle = {
            color: "#007bff", // äº®è—è‰²
            weight: 3,        // ç·šæ¢ç²—ç´°
            opacity: 0.7      // é€æ˜åº¦
        };

        // é€™æ˜¯è®€å–æª”æ¡ˆçš„ä¸»ç¨‹å¼
        function loadNextPart() {
            var fileName = filePrefix + currentPart + fileSuffix;
            var loadingText = document.getElementById('loading-text');
            var loadingDetail = document.getElementById('loading-detail');
            var statusBox = document.getElementById('status');

            loadingDetail.innerText = `æ­£åœ¨è®€å–æª”æ¡ˆ: ${fileName}`;

            // ä½¿ç”¨ fetch æŠ“å–æª”æ¡ˆ
            fetch(fileName)
                .then(response => {
                    // å¦‚æœæ‰¾ä¸åˆ°æª”æ¡ˆ (ä¾‹å¦‚è®€åˆ° map_part_6.geojson ç™¼ç¾æ²’æœ‰äº†)ï¼Œå°±åœæ­¢
                    if (!response.ok) {
                        throw new Error("No more files");
                    }
                    return response.json();
                })
                .then(data => {
                    // æˆåŠŸè®€å–åˆ°è³‡æ–™ï¼ŒæŠŠå®ƒç•«åœ¨åœ°åœ–ä¸Š
                    L.geoJSON(data, {
                        style: sidewalkStyle,
                        onEachFeature: function(feature, layer) {
                            // é€™è£¡è™•ç†é»æ“Šå¾Œçš„å½ˆå‡ºè¦–çª—
                            var p = feature.properties;
                            var info = "<div style='font-size:14px'><b>ğŸ›£ï¸ äººè¡Œé“è³‡è¨Š</b><br><hr style='margin:5px 0'>";
                            
                            // åˆ¤æ–·ä¸¦é¡¯ç¤ºæ¬„ä½ (æ ¹æ“šæ”¿åºœè³‡æ–™å¸¸è¦‹æ ¼å¼)
                            if(p.ROAD_NAME) info += `è·¯å: ${p.ROAD_NAME}<br>`;
                            if(p.SW_WTH)    info += `å¯¬åº¦: <b>${p.SW_WTH}</b> å…¬å°º<br>`;
                            if(p.SWW_WTH)   info += `æ·¨å¯¬(ç„¡éšœç¤™): <b style='color:green'>${p.SWW_WTH}</b> å…¬å°º<br>`;
                            if(p.RAMP_TYPE) info += `å¡é“: ${p.RAMP_TYPE}<br>`;
                            
                            info += "</div>";
                            layer.bindPopup(info);
                        }
                    }).addTo(map);

                    // æ›´æ–°ç•«é¢æ–‡å­—
                    totalLoaded++;
                    statusBox.innerText = `å·²è¼‰å…¥ç¬¬ ${currentPart} éƒ¨åˆ†...`;
                    
                    // ç¹¼çºŒè®€å–ä¸‹ä¸€ä»½ (éè¿´å‘¼å«)
                    currentPart++;
                    loadNextPart();
                })
                .catch(error => {
                    // ç•¶ç™¼ç”ŸéŒ¯èª¤æˆ–æ‰¾ä¸åˆ°æª”æ¡ˆæ™‚ï¼Œä»£è¡¨å…¨éƒ¨è®€å®Œäº†
                    console.log("Loading finished or stopped:", error.message);
                    
                    // éš±è—è®€å–ç•«é¢
                    document.getElementById('loading').style.display = 'none';
                    
                    // æ›´æ–°ç‹€æ…‹æ¬„
                    if (currentPart > 1) {
                        statusBox.innerHTML = `âœ… åœ–è³‡è¼‰å…¥å®Œæˆï¼<br>å…±è¼‰å…¥ ${currentPart - 1} ä»½æª”æ¡ˆã€‚<br>è«‹æ”¾å¤§åœ°åœ–æŸ¥çœ‹è—è‰²è·¯ç¶²ã€‚`;
                    } else {
                        statusBox.innerHTML = `âŒ è¼‰å…¥å¤±æ•—ã€‚<br>æ‰¾ä¸åˆ° ${fileName}<br>è«‹ç¢ºèª GitHub ä¸Šæ˜¯å¦æœ‰ä¸Šå‚³ map_part_1.geojson`;
                        alert("è®€å–å¤±æ•—ï¼è«‹ç¢ºèªæ‚¨æ˜¯å¦å·²ä¸Šå‚³ map_part_1.geojson åˆ° GitHubï¼Ÿ");
                    }
                });
        }

        // é–‹å§‹åŸ·è¡Œè®€å–
        loadNextPart();

    </script>
</body>
</html>
