<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>å…¨å°äººè¡Œé“å°èˆªåœ°åœ– (å®Œæ•´ç‰ˆ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; background: #eee; }
        
        /* è³‡è¨Šé¢æ¿æ¨£å¼ */
        .info-box {
            position: absolute; top: 10px; left: 50px; z-index: 1000;
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: "Microsoft JhengHei", sans-serif;
            max-width: 300px;
        }
        
        /* è®€å–é€²åº¦æ¢æ¨£å¼ */
        .loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; color: white; font-family: sans-serif;
        }
        .spinner {
            border: 6px solid #f3f3f3; border-top: 6px solid #3498db;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* iPad/æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 600px) {
            .info-box { left: 10px; right: 10px; top: 10px; max-width: none; }
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text">æ­£åœ¨å•Ÿå‹•å°èˆªç³»çµ±...</div>
        <div id="loading-detail" style="font-size: 0.8em; color: #ccc; margin-top: 5px;">æº–å‚™è®€å–åœ–è³‡</div>
    </div>

    <div class="info-box">
        <h3 style="margin: 0 0 10px 0;">ğŸš¶ å…¨å°äººè¡Œé“åœ°åœ–</h3>
        <div id="status" style="font-size: 14px; color: #555;">
            åˆå§‹åŒ–ä¸­...
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ– (é è¨­ä¸­å¿ƒé»ï¼šå°ç£ä¸­éƒ¨)
        var map = L.map('map').setView([23.97565, 120.9738819], 8);

        // 2. åŠ å…¥åº•åœ– (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors | è³‡æ–™ä¾†æº: åœ‹åœŸç®¡ç†ç½²',
            maxZoom: 19
        }).addTo(map);

        // ==========================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ è«‹åœ¨é€™è£¡ç¢ºèªæ‚¨çš„æª”æ¡ˆæ¸…å–® ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ==========================================
        var mapFiles = [
            'map_part_1.geojson',
            'map_part_2.geojson',
            'map_part_3.geojson',
            'map_part_4.geojson',
            'map_part_5.geojson'
            // âš ï¸ å¦‚æœæ‚¨çš„æª”æ¡ˆæ›´å¤š (ä¾‹å¦‚åˆ° part_10)ï¼Œè«‹ä¾ç…§æ ¼å¼ç¹¼çºŒåŠ ä¸‹å»
            // âš ï¸ å¦‚æœæ‚¨çš„æª”æ¡ˆåªæœ‰ 3 å€‹ï¼Œè«‹æŠŠä¸Šé¢å¤šé¤˜çš„ 4 å’Œ 5 åˆªæ‰
        ];
        // ==========================================


        // è¨­å®šäººè¡Œé“æ¨£å¼ (è—è‰²ç·šæ¢)
        var sidewalkStyle = {
            color: "#007bff", // äº®è—è‰²
            weight: 3,        // ç·šæ¢ç²—ç´°
            opacity: 0.7      // é€æ˜åº¦
        };

        var totalFiles = mapFiles.length;

        // é€™æ˜¯æ–°çš„æ‰‹å‹•è®€å–ä¸»ç¨‹å¼
        function loadMapData(index) {
            
            // å¦‚æœ index è¶…éæª”æ¡ˆæ•¸é‡ï¼Œä»£è¡¨å…¨éƒ¨è®€å®Œäº†
            if (index >= totalFiles) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('status').innerHTML = `âœ… åœ–è³‡è¼‰å…¥å®Œæˆï¼<br>å…±è¼‰å…¥ ${totalFiles} ä»½æª”æ¡ˆã€‚<br>è«‹æ”¾å¤§åœ°åœ–æŸ¥çœ‹è—è‰²è·¯ç¶²ã€‚`;
                return;
            }

            var fileName = mapFiles[index];
            
            // æ›´æ–°è®€å–ç•«é¢æ–‡å­—
            document.getElementById('loading-text').innerText = `æ­£åœ¨è®€å– (${index + 1}/${totalFiles})`;
            document.getElementById('loading-detail').innerText = fileName;
            document.getElementById('status').innerText = `è¼‰å…¥ä¸­: ${fileName}...`;

            // ä½¿ç”¨ fetch æŠ“å–æª”æ¡ˆ
            fetch(fileName)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("æª”æ¡ˆè®€å–å¤±æ•— (404)");
                    }
                    return response.json();
                })
                .then(data => {
                    // æˆåŠŸè®€å–åˆ°è³‡æ–™ï¼ŒæŠŠå®ƒç•«åœ¨åœ°åœ–ä¸Š
                    L.geoJSON(data, {
                        style: sidewalkStyle,
                        onEachFeature: function(feature, layer) {
                            // é€™è£¡è™•ç†é»æ“Šå¾Œçš„å½ˆå‡ºè¦–çª— (ä¿ç•™æ‚¨åŸæœ¬æ¼‚äº®çš„æ¨£å¼)
                            var p = feature.properties;
                            var info = "<div style='font-size:14px'><b>ğŸ›£ï¸ äººè¡Œé“è³‡è¨Š</b><br><hr style='margin:5px 0'>";
                            
                            // åˆ¤æ–·ä¸¦é¡¯ç¤ºæ¬„ä½
                            if(p.ROAD_NAME) info += `è·¯å: ${p.ROAD_NAME}<br>`;
                            if(p.SW_WTH)    info += `å¯¬åº¦: <b>${p.SW_WTH}</b> å…¬å°º<br>`;
                            if(p.SWW_WTH)   info += `æ·¨å¯¬(ç„¡éšœç¤™): <b style='color:green'>${p.SWW_WTH}</b> å…¬å°º<br>`;
                            if(p.RAMP_TYPE) info += `å¡é“: ${p.RAMP_TYPE}<br>`;
                            
                            info += "</div>";
                            layer.bindPopup(info);
                        }
                    }).addTo(map);

                    // æˆåŠŸå¾Œï¼Œè®€å–ä¸‹ä¸€ä»½ (index + 1)
                    loadMapData(index + 1);
                })
                .catch(error => {
                    console.log("Error loading file:", fileName, error);
                    // å°±ç®—é€™ä»½å¤±æ•—ï¼Œä¹Ÿå˜—è©¦è®€å–ä¸‹ä¸€ä»½ï¼Œé¿å…å¡æ­»
                    document.getElementById('status').innerText += ` (å¤±æ•—)`;
                    loadMapData(index + 1);
                });
        }

        // é–‹å§‹åŸ·è¡Œè®€å–
        loadMapData(0);

    </script>
</body>
</html>
