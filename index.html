<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>å…¨å°äººè¡Œé“å°èˆªåœ°åœ– (å®Œæ•´ç‰ˆ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { width: 100%; height: 100vh; background: #eee; }
        
        /* è³‡è¨Šé¢æ¿æ¨£å¼ */
        .info-box {
            position: absolute; top: 10px; left: 50px; z-index: 1000;
            background: white; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: "Microsoft JhengHei", sans-serif;
            max-width: 300px;
        }
        
        /* è®€å–é€²åº¦æ¢æ¨£å¼ */
        .loading-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; color: white; font-family: sans-serif;
        }
        .spinner {
            border: 6px solid #f3f3f3; border-top: 6px solid #3498db;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* iPad/æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 600px) {
            .info-box { left: 10px; right: 10px; top: 10px; max-width: none; }
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-text">æ­£åœ¨å•Ÿå‹•å°èˆªç³»çµ±...</div>
        <div id="loading-detail" style="font-size: 0.8em; color: #ccc; margin-top: 5px;">æº–å‚™è®€å–åœ–è³‡</div>
    </div>

    <div class="info-box">
        <h3 style="margin: 0 0 10px 0;">ğŸš¶ å…¨å°äººè¡Œé“åœ°åœ–</h3>
        <div id="status" style="font-size: 14px; color: #555;">
            è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. åˆå§‹åŒ–åœ°åœ– (é è¨­ä¸­å¿ƒé»ï¼šå°ç£ä¸­éƒ¨)
        var map = L.map('map').setView([23.97565, 120.9738819], 8);

        // 2. åŠ å…¥åº•åœ– (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors | è³‡æ–™ä¾†æº: åœ‹åœŸç®¡ç†ç½²',
            maxZoom: 19
        }).addTo(map);

        // ==========================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ è¨­å®šå€ï¼šæŒ‡å®šç¸½å…±æœ‰ 13 ä»½æª”æ¡ˆ ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ==========================================
        
        var totalParts = 14;   // <--- é€™è£¡è¨­å®šç‚º 13
        var mapFiles = [];
        
        // è‡ªå‹•ç”¢ç”Ÿ ['map_part_1.geojson', ..., 'map_part_13.geojson']
        for (var i = 1; i <= totalParts; i++) {
            mapFiles.push('map_part_' + i + '.geojson');
        }
        // ==========================================

        var style = { color: "#007bff", weight: 3, opacity: 0.7 };
        var totalFiles = mapFiles.length;

        // æ–°çš„è®€å–é‚è¼¯ï¼šä¾ç…§æ¸…å–®ä¸€å€‹æ¥ä¸€å€‹è®€
        function loadMapData(index) {
            
            // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨è®€å®Œ
            if (index >= totalFiles) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('status').innerHTML = `âœ… åœ–è³‡è¼‰å…¥å®Œæˆï¼<br>å…±è¼‰å…¥ ${totalFiles} ä»½æª”æ¡ˆã€‚<br>è«‹æ”¾å¤§åœ°åœ–æŸ¥çœ‹è—è‰²è·¯ç¶²ã€‚`;
                console.log("å…¨éƒ¨è®€å–å®Œæˆ");
                return;
            }

            var fileName = mapFiles[index];
            var displayIndex = index + 1;

            // æ›´æ–°ç•«é¢é¡¯ç¤º
            document.getElementById('loading-text').innerText = `æ­£åœ¨è®€å–ç¬¬ ${displayIndex} / ${totalFiles} ä»½`;
            document.getElementById('loading-detail').innerText = `æª”æ¡ˆ: ${fileName}`;
            document.getElementById('status').innerText = `è¼‰å…¥ä¸­: ${fileName}...`;

            // ä½¿ç”¨ fetch æŠ“å–æª”æ¡ˆ
            fetch(fileName)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆ (HTTP ${response.status})`);
                    }
                    return response.json();
                })
                .then(data => {
                    // ç•«åœ–
                    L.geoJSON(data, {
                        style: style,
                        onEachFeature: function(feature, layer) {
                            var p = feature.properties;
                            var info = "<div style='font-size:14px'><b>ğŸ›£ï¸ äººè¡Œé“è³‡è¨Š</b><br><hr style='margin:5px 0'>";
                            if(p.ROAD_NAME) info += `è·¯å: ${p.ROAD_NAME}<br>`;
                            if(p.SW_WTH)    info += `å¯¬åº¦: <b>${p.SW_WTH}</b> å…¬å°º<br>`;
                            if(p.SWW_WTH)   info += `æ·¨å¯¬(ç„¡éšœç¤™): <b style='color:green'>${p.SWW_WTH}</b> å…¬å°º<br>`;
                            if(p.RAMP_TYPE) info += `å¡é“: ${p.RAMP_TYPE}<br>`;
                            info += "</div>";
                            layer.bindPopup(info);
                        }
                    }).addTo(map);

                    // æˆåŠŸå¾Œï¼Œè®€å–ä¸‹ä¸€ä»½ (index + 1)
                    loadMapData(index + 1);
                })
                .catch(error => {
                    console.error(`Error loading ${fileName}:`, error);
                    // âš ï¸ é—œéµä¿®æ”¹ï¼šå°±ç®—é€™ä»½å¤±æ•—ï¼Œä¹Ÿè¦ç¹¼çºŒè®€ä¸‹ä¸€ä»½ï¼Œä¸è¦åœä¸‹ä¾†
                    document.getElementById('status').innerHTML += `<br><span style="color:red">âš ï¸ ${fileName} è®€å–å¤±æ•—</span>`;
                    loadMapData(index + 1);
                });
        }

        // é–‹å§‹åŸ·è¡Œ
        loadMapData(0);

    </script>
</body>
</html>
